@model List<CarDealership.Models.ViewModels.UserSaleViewModel>
@{
    ViewBag.Title = "Sales Report";
}

<h2>@ViewBag.Title</h2>

<br />

<div class="GridBoxSearch row">
    <form id="searchForm" class="form-inline" role="form">

        <div class="form-group" style="margin-right:20px">
            <label>User</label>
            <select class="form-control" id="user">
                <option value="">
                    - All -
                </option>
                @foreach (var item in Model)
                {
                    <option value="@item.UserId">
                        @item.FullName
                    </option>
                }
            </select>

        </div>


        <div class="form-group" style="margin-right:20px">
            <label>From Date</label>
            <input class="form-control" type="text" name="fromDate" value="" id="fromDate">
        </div>


        <div class="form-group" style="margin-right:20px">
            <label>To Date</label>
            <input class="form-control" type="text" name="toDate" value="" id="toDate">
        </div>

        <button id="btnSearch" class="btn btn-default">Search</button>
    </form>
</div>

<br />

<div class="row" id="searchResultsTitle"></div>
<div id="searchResults">

</div>


@section Scripts{

    <script>

        $(document).ready(function () {

            $('#searchForm').submit(function () {
                search();
                return false;
            });
        });

        function formatMoney(number) {
            return number.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
}

        function search() {
            var params;

            params = 'userId=' + $('#user').val() + '&fromDate=' + $('#fromDate').val() + '&toDate=' + $('#toDate').val();

            $.ajax({
                type: 'Get',
                url: 'https://localhost:44395/api/vehicle/inventorysearch?' + params,
                success: function (results) {

                    $('#searchResultsTitle').empty();
                    $('#searchResultsTitle').append('<h2>Search Results</h2>');
                    $("#searchResults").empty();

                    var html = `<table class="table table-bordered" id="dvdTable">
                <thead>
                    <tr>
                        <th width="30%" style="text-align: center">User</th>
                        <th width="15%" style="text-align: center">Total Sales</th>
                        <th width="25%" style="text-align: center">Total Vehicles</th>
                    </tr>
                </thead>

                <tbody id="contentRows">`;

                    $.each(results, function (index, item) {

                        html += '<tr>';
                        html += '<td style="text-align: center">' + item.User + '</td>';
                        html += '<td style="text-align: center">' + formatMoney(item.TotalSales) + '</td>';
                        html += '<td style="text-align: center">' + item.TotalVehicles + '</td>';
                        html += '</tr>';

                    });
                    html += '</tbody>';
                    html += '</table>';

                    $("#searchResults").append(html);
                }

            });
        }

    </script>
}