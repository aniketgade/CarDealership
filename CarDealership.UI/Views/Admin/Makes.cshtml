@model CarDealership.Models.Tables.Make
@{
    ViewBag.Title = "Makes";
}

<h2>@ViewBag.Title</h2>

<div class="GridBoxMakes">
    @using (Html.BeginForm("Makes", "Admin", FormMethod.Post, new { @class = "form-inline", role = "form" }))
    {
        <div class="form-group" style="padding-right:25px">
            <label class="control-label" style="padding-right:5px">Make Name</label>

            @Html.TextBoxFor(m => m.MakeName, new { @class = "form-control", @style = "width:300px", Value="" })

        </div>

        <div class="form-group">

            <input type="submit" class="btn btn-default" value="Save" />

        </div>

    }
</div>

<br />
<br />

<div id="makeTableDiv">
    <table class="table table-bordered" id="dvdTable">
        <thead>
            <tr>
                <th width="30%" style="text-align: center">Make</th>
                <th width="15%" style="text-align: center">Date Added</th>
                <th width="25%" style="text-align: center">User</th>
            </tr>
        </thead>

        <tbody id="contentRows">
            <!--This holds the list of makes - we will add rows dynamically using jQuery -->
        </tbody>

    </table>
</div>
@section Scripts{

    <script>

        $(document).ready(function () {

            loadMakeTable();
        });

        function loadMakeTable() {

            var contentRows = $('#contentRows');
            contentRows.empty();

            $.ajax({
                type: 'Get',
                url: 'https://localhost:44395/api/vehicle/makeDetails',
                success: function (makeList) {
                    $.each(makeList, function (index, make) {
                        var makeName = make.MakeName;
                        var dateAdded = formatDate(make.DateAdded);
                        var user = make.UserEmail;


                        var row = '<tr>';
                        row += '<td style="text-align: center">' + makeName + '</td>';
                        row += '<td style="text-align: center">' + dateAdded + '</td>';
                        row += '<td style="text-align: center">' + user + '</td>';
                        row += '</tr>';

                        contentRows.append(row);
                    })


                },
                error: function () {
                    $('#errorMessages').append($('<li>').attr({ class: 'list-group-item list-group-item-danger' }).text('Error calling web service. Please try again later.'));
                }
            });
        }

        function formatDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;

            return [month, day, year].join('-');
        }

    </script>




}